<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Leaderboard — Electro Gang Community</title>
  <style>
    :root{ --card-bg:rgba(0,0,0,0.72); --text:#e8f6ff; }
    body{
      margin:0;
      min-height:100vh;
      font-family:Arial, sans-serif;
      background: url('bg.jpeg') center/cover no-repeat fixed;
      color:var(--text);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding-top:40px;
    }
    .wrap{
      width:360px;
      border-radius:12px;
      padding:18px;
      background:var(--card-bg);
      box-shadow:0 10px 30px rgba(2,6,23,0.6);
    }
    h1{ text-align:center; margin:4px 0 12px; font-size:18px; }
    .msg{ font-size:13px; color:#bcd8ee; text-align:center; margin-bottom:10px; }
    input{ width:86%; padding:8px; border-radius:8px; border:none; margin:6px 0; background:#111; color:var(--text); }
    .btn{ width:88%; padding:10px; border-radius:10px; border:none; cursor:pointer; font-weight:700; color:#00131a; background:linear-gradient(135deg,#00c6ff,#0072ff); margin:8px 0; }
    ul{ list-style:none; padding:0; margin:12px 0 0; max-height:360px; overflow:auto; }
    li{ background:rgba(0,0,0,0.45); margin:8px 0; padding:10px 12px; border-radius:8px; display:flex; justify-content:space-between; }
    .small{ font-size:12px; color:#9fb2c8; text-align:center; margin-top:8px; }
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <h1>Leaderboard — Electro Gang</h1>
    <div id="gateArea">
      <div class="msg">This leaderboard is protected. Enter the leaderboard password to view it on this device.</div>
      <input id="leaderPass" type="password" placeholder="Enter leaderboard password">
      <button class="btn" id="unlockBtn">Unlock</button>
      <div class="small">Password will be remembered on this device only.</div>
    </div>

    <div id="boardArea" style="display:none;">
      <div class="msg">Top players (updates live)</div>
      <ul id="boardList"></ul>
      <div class="small">Users and XP are shared across devices.</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAblev6Eozr521krNg5sRt-GLng0Pt1dRo",
      authDomain: "electro-playz-community.firebaseapp.com",
      databaseURL: "https://electro-playz-community-default-rtdb.firebaseio.com/",
      projectId: "electro-playz-community",
      storageBucket: "electro-playz-community.firebasestorage.app",
      messagingSenderId: "630817725431",
      appId: "1:630817725431:web:05f83dbd2684f5c7a3ecf2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const LB_PASSWORD = 'xuhjhfrihdsa'; // your requested leaderboard password
    const gateArea = document.getElementById('gateArea');
    const boardArea = document.getElementById('boardArea');
    const unlockBtn = document.getElementById('unlockBtn');
    const passInput = document.getElementById('leaderPass');
    const boardList = document.getElementById('boardList');

    // if previously unlocked on this device, show directly
    if (localStorage.getItem('leaderboardUnlocked') === 'yes') {
      showBoard();
    }

    unlockBtn.addEventListener('click', () => {
      const v = passInput.value.trim();
      if (v === LB_PASSWORD) {
        localStorage.setItem('leaderboardUnlocked', 'yes');
        showBoard();
      } else {
        alert('Incorrect leaderboard password.');
      }
    });

    function showBoard(){
      gateArea.style.display = 'none';
      boardArea.style.display = 'block';
      // listen to users in firebase and update list live
      const usersRef = ref(db, 'users');
      onValue(usersRef, (snapshot) => {
        const data = snapshot.val() || {};
        // convert to array sorted by xp desc
        const arr = Object.entries(data).map(([name, info]) => ({ name, xp: info.xp || 0 }));
        arr.sort((a,b) => b.xp - a.xp);
        boardList.innerHTML = '';
        arr.forEach((p, i) => {
          const li = document.createElement('li');
          li.innerHTML = `<span>#${i+1} ${escapeHtml(p.name)}</span><strong>${p.xp} XP</strong>`;
          boardList.appendChild(li);
        });
      }, (err) => {
        console.error(err);
        alert('Could not load leaderboard (network or permission).');
      });
    }

    // small helper
    function escapeHtml(s){
      return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Profile — Electro Gang Community</title>
  <style>
    :root{ --accent1:#00c6ff; --accent2:#0072ff; --card-bg:rgba(0,0,0,0.72); --text:#e8f6ff; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:Arial, sans-serif;
      background: url('bg.jpeg') center/cover no-repeat fixed;
      color:var(--text);
    }
    .card{
      width:360px;
      border-radius:14px;
      background:var(--card-bg);
      padding:26px;
      text-align:center;
      box-shadow:0 10px 30px rgba(2,6,23,0.6);
    }
    h1{ margin:0 0 6px; font-size:20px; }
    p{ margin:6px 0 14px; color:#bcd8ee; }
    .btn{
      width:80%;
      margin:8px auto;
      padding:10px;
      border-radius:12px;
      border:none;
      font-weight:700;
      cursor:pointer;
      color:#00131a;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
    }
    .small{ font-size:12px; color:#9fb2c8; margin-top:10px; }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="name">—</h1>
    <p>Your XP: <strong id="xp">0</strong></p>

    <!-- Earn XP button and Leaderboard button -->
    
   <a href="leaderboard.html"> <button class="btn" id="leaderBtn">Open Leaderboard</button></a>

    <button style="margin-top:12px; background:transparent; color:#cfe8ff; border:none; cursor:pointer;" id="logoutBtn">Log out</button>

    <div class="small">Password is stored locally on this device so you don't need to sign in again here.</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAblev6Eozr521krNg5sRt-GLng0Pt1dRo",
      authDomain: "electro-playz-community.firebaseapp.com",
      databaseURL: "https://electro-playz-community-default-rtdb.firebaseio.com/",
      projectId: "electro-playz-community",
      storageBucket: "electro-playz-community.firebasestorage.app",
      messagingSenderId: "630817725431",
      appId: "1:630817725431:web:05f83dbd2684f5c7a3ecf2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const user = localStorage.getItem('eg_user');
    const pass = localStorage.getItem('eg_pass');

    if (!user || !pass) {
      alert('Not signed in. Redirecting to login.');
      location.href = 'login.html';
    }

    const nameEl = document.getElementById('name');
    const xpEl = document.getElementById('xp');
    const earnBtn = document.getElementById('earnBtn');
    const leaderBtn = document.getElementById('leaderBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    nameEl.textContent = user;

    // load XP from Firebase
    async function loadXP(){
      try {
        const snap = await get(ref(db, 'users/' + user));
        if (snap.exists()){
          xpEl.textContent = snap.val().xp || 0;
        } else {
          // if no user, create
          await set(ref(db, 'users/' + user), { password: pass, xp: 0 });
          xpEl.textContent = 0;
        }
      } catch(e){ console.error(e); alert('Network error'); }
    }

    // add +10 XP: update Firebase and update local display
    async function addXP(){
      try {
        const r = ref(db, 'users/' + user);
        const snap = await get(r);
        let current = (snap.exists() && snap.val().xp) ? Number(snap.val().xp) : 0;
        current += 10;
        // write back (keep password intact)
        await set(r, { password: pass, xp: current });
        xpEl.textContent = current;
      } catch(e){ console.error(e); alert('Could not update XP'); }
    }

    earnBtn.addEventListener('click', addXP);

    // When opening leaderboard from profile, give +10 XP then redirect
    leaderBtn.addEventListener('click', async () => {
      await addXP();          // award +10 XP
      // unlock leaderboard on this device if not already (optional: user must still enter password)
      // redirect
      location.href = 'leaderboard.html';
    });

    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('eg_user');
      localStorage.removeItem('eg_pass');
      alert('Logged out');
      location.href = 'login.html';
    });

    loadXP();
  </script>
</body>
</html>
